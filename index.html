<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>挿絵・描写精度アンケート</title>

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <style>
    :root{
      --bg:#0b0c10; --panel:#151821; --ink:#e8ecf1; --muted:#a7b0bd; --accent:#5aa9e6; --ok:#3ccf91;
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
      font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Meiryo",sans-serif}
    .wrap{max-width:1050px;margin:0 auto;padding:24px}
    .card{background:var(--panel);border:1px solid rgba(255,255,255,.06);
      border-radius:var(--radius);box-shadow:0 8px 30px rgba(0,0,0,.3)}
    .pad{padding:20px}
    h1{font-size:clamp(20px,2.4vw,28px);margin:0 0 12px}
    p{color:var(--muted);line-height:1.7}
    label{display:block;margin:10px 0;color:var(--ink)}
    input[type="text"]{width:100%;padding:12px 14px;border-radius:12px;
      border:1px solid rgba(255,255,255,.12);background:#0f1117;color:var(--ink)}
    button{appearance:none;border:0;background:var(--accent);color:#071018;
      padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer}
    button[disabled]{opacity:.5;cursor:not-allowed}
    .row{display:flex;gap:14px;flex-wrap:wrap}
    .space{height:12px}
    .muted{color:var(--muted)}
    .center{text-align:center}
    .sceneBox{background:#0f1117;border:1px dashed rgba(255,255,255,.1);
      border-radius:12px;padding:14px}
    .sceneTitle{font-weight:800;letter-spacing:.04em;margin-bottom:6px}
    .imgWrap{
      display:flex;
      justify-content:center;
      align-items:center;
      background:#0b0d13;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.08);
      padding:8px;
      width:100%;
      max-width:350px;   /* PCでは最大700pxまで広げる */
      margin:20px auto;     /* 中央寄せ */
    }
    
    img{
      width:100%;
      height:auto;       /* 高さを自動調整 */
      max-height:35vh;   /* スマホ画面で縦が大きすぎないように制限 */
      object-fit:contain;
      border-radius:10px;
      display:block;
    }
    .controls{display:flex;align-items:center;justify-content:space-between;
      gap:10px;margin-top:12px}
    .choices{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px}
    .progress{height:10px;background:#0f1117;border-radius:999px;overflow:hidden;
      border:1px solid rgba(255,255,255,.08)}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--ok),#5aa9e6)}
    .tag{display:inline-block;background:#0f1117;border:1px solid rgba(255,255,255,.08);
      padding:4px 8px;border-radius:999px;color:var(--muted);font-size:12px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .tiny{font-size:12px}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,.2);color:var(--ink)}
    .hidden{display:none}
    .foot{display:flex;gap:8px;align-items:center;justify-content:flex-end}

    /* --- バッジ装飾 --- */
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      color: white;
    }
    .b-ok { background: #3ccf91; }      /* 緑：描写できている */
    .b-mid { background: #ffcc66; color:#000; } /* 黄：どちらでもない */
    .b-ng { background: #ff6b6b; }      /* 赤：描写できていない */
    /* --- バッジ文字を黒に変更 --- */
    .b-ok, .b-ng {
      color: #000 !important;  /* 強制的に黒文字にする */
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div id="app" class="card pad">
      <section id="stepIntro">
        <h1>挿絵・描写精度アンケート</h1>
        <p>
          本アンケートでは、小説『浦島太郎』の一部をもとに、画像生成AIによって作成された挿絵を評価していただきます。<br><br>
          各シーンごとに、元の文章と生成された画像（1シーンあたり計30枚）を見比べてください。<br><br>
          そのうえで、各画像を
          <strong>「文章の内容を描写できている」</strong>・
          <strong>「文章の内容を描写できていない」</strong>・
          <strong>「どちらでもない」</strong>
          のいずれかを選択してください。
        </p>

        <p>
          以下、アンケートの記入方法です。<br><br>
          「次へ（開始）」を押下すると、シーン本文と画像が表示されます。<br>
          本文と画像を見比べ、
          <span class="badge b-ok">「描写できている」</span><span class="badge b-mid">「どちらでもない」</span><span class="badge b-ng">「描写できていない」</span>
          のいずれかにチェックを入れ、「次へ」を押下してください。<br>
          ※「次へ」を押下した際、数秒のラグが発生しますが、
          「次へ」を2回以上押下しないでください。<br><br>
          30枚の画像の評価を終えると次のシーンに進みます（全5シーン）。<br>
          評価終了後、ブラウザを閉じてください。
        </p>
        <div class="grid2">
          <div>
            <label>回答者氏名（必須）<input id="responderName" type="text" placeholder="例）山田太郎"></label>
          </div>
        </div>
        <div class="foot"><button id="btnStart" disabled>次へ（開始）</button></div>
      </section>

      <section id="stepSurvey" class="hidden">
        <div class="sceneBox">
          <div class="sceneTitle">シーン</div>
          <h2 id="sceneTitle"></h2>
          <p id="sceneText"></p>
          <!-- <span class="tag" id="methodTag"></span> -->
          <span class="tag" id="counterTag"></span>
        </div>
        <p class="muted">画像を評価してください。</p>
        <div class="imgWrap"><img id="targetImg" alt="評価画像"></div>
        <div class="choices">
          <label><input type="checkbox" name="rating" value="描写できている"> 描写できている</label>
          <label><input type="checkbox" name="rating" value="どちらでもない"> どちらでもない</label>
          <label><input type="checkbox" name="rating" value="描写できていない"> 描写できていない</label>
        </div>
        <div class="controls">
          <button class="ghost" id="btnBack">戻る</button>
          <button id="btnNext">次へ</button>
        </div>
        <p id="warnMsg" class="tiny muted"></p>
      </section>

      <section id="stepFinish" class="hidden center">
        <h1>ご協力ありがとうございました！</h1>
        <p>全ての評価が完了しました。</p>
      </section>
    </div>
  </div>

<script>
// ✅ あなたのGASのWebアプリURLをここに貼り付けてください
const GAS_ENDPOINT = "https://urashima-survey.vercel.app/api/proxy";

// ======== シーン構成 ========
const scenes = [
  {
    id: "S1",
    title: "浦島太郎が玉手箱を開け、お爺さんになるシーン",
    text: `本文：
　しおしおとまた浜べへ出てみましたが、海の水はまんまんとたたえていて、どこがはてともしれません。
　もうかめも出てきませんから、どうしてりゅう宮へわたろう手だてもありませんでした。 
　そのとき、浦島はふと、かかえていた玉手箱に気がつきました。

「そうだ。この箱はこをあけてみたらば、わかるかもしれない」

　こうおもうとうれしくなって、浦島は、うっかり乙姫さまにいわれたことはわすれて、箱のふたをとりました。するとむらさき色の雲が、なかからむくむく立ちのぼって、それが顔にかかったかとおもうと、すうっと消えて行って箱のなかにはなんにものこっていませんでした。
　その代わり、いつのまにか顔じゅうしわになって、手も足もちぢかまって、きれいなみぎわの水にうつった影かげを見ると、髪かみもひげも、まっしろな、かわいいおじいさんになっていました。
　浦島はからになった箱はこのなかをのぞいて、

「なるほど、乙姫さまが、人間のいちばんだいじなたからを入れておくとおっしゃったあれは、人間の寿命だったのだな」

　と、ざんねんそうにつぶやきました。
　春の海はどこまでも遠くかすんでいました。どこからかいい声で舟うたをうたうのが、またきこえてきました。
　浦島は、ぼんやりとむかしのことをおもい出していました。`,
    methods: [
      {name:"方法A：原文そのまま",images:Array.from({length:10},(_,i)=>`img/scene1/a_${String(i+1).padStart(2,'0')}.png`)},
      {name:"方法B：抽出要素",images:Array.from({length:10},(_,i)=>`img/scene1/b_${String(i+1).padStart(2,'0')}.png`)},
      {name:"方法C：要約ベース",images:Array.from({length:10},(_,i)=>`img/scene1/c_${String(i+1).padStart(2,'0')}.png`)}
    ]
  },

  {
    id: "S2",
    title: "冒頭シーン",
    text: `本文：
　むかし、むかし、丹後の国水の江の浦に、浦島太郎という漁師がありました。
　浦島太郎は、毎日釣り竿を担いでは海へ出かけて、鯛や、鰹などのお魚を釣って、お父さんお母さんを養っていました。`,
    methods: [
      {name:"方法A：原文そのまま",images:Array.from({length:10},(_,i)=>`img/scene2/a_${String(i+1).padStart(2,'0')}.png`)},
      {name:"方法B：抽出要素",images:Array.from({length:10},(_,i)=>`img/scene2/b_${String(i+1).padStart(2,'0')}.png`)},
      {name:"方法C：要約ベース",images:Array.from({length:10},(_,i)=>`img/scene2/c_${String(i+1).padStart(2,'0')}.png`)}
    ]
  },

  {
    id: "S3",
    title: "亀が浦島太郎を竜宮城に誘うシーン",
    text: `本文：
　それから二、三日たって、浦島はまた舟にのって海へつりに出かけました。
　遠い沖のほうまでもこぎ出して、一生けんめいおさかなをつっていますと、ふとうしろのほうで

「浦島さん、浦島さん」

　とよぶ声がしました。おやとおもってふりかえってみますと、だれも人のかげは見えません。その代り、いつのまにか、一ぴきのかめが、舟のそばにきていました。

　浦島がふしぎそうな顔をしていると、

「わたくしは、先日助けていただいたかめでございます。きょうはちょっとそのお礼にまいりました」

　かめがこういったので、浦島はびっくりしました。

「まあ、そうかい。わざわざ礼なんぞいいにくるにはおよばないのに」
「でも、ほんとうにありがとうございました。ときに、浦島さん、あなたはりゅう宮をごらんになったことがありますか」
「いや、話にはきいているが、まだ見たことはないよ」
「ではほんのお礼のしるしに、わたくしがりゅう宮を見せて上げたいとおもいますがいかがでしょう」
「へえ、それはおもしろいね。ぜひ行ってみたいが、それはなんでも海の底にあるということではないか。どうして行くつもりだね。わたしにはとてもそこまでおよいでは行けないよ」
「なに、わけはございません。わたくしの背中におのりください」

　かめはこういって、背中を出しました。浦島は半分きみわるくおもいながら、いわれるままに、かめの背中にのりました。`,
    methods: [
      {name:"方法A：原文そのまま",images:Array.from({length:10},(_,i)=>`img/scene3/a_${String(i+1).padStart(2,'0')}.png`)},
      {name:"方法B：抽出要素",images:Array.from({length:10},(_,i)=>`img/scene3/b_${String(i+1).padStart(2,'0')}.png`)},
      {name:"方法C：要約ベース",images:Array.from({length:10},(_,i)=>`img/scene3/c_${String(i+1).padStart(2,'0')}.png`)}
    ]
  },

  {
    id: "S4",
    title: "浦島太郎が亀の背に乗って、竜宮城から浜辺へ帰ってくるシーン",
    text: `本文：
　浦島はうれしいのとかなしいのとで、胸むねがいっぱいになっていました。そしてかめの背中にのりますと、かめはすぐ波を切って上がって行って、まもなくもとの浜べにつきました。

「では浦島さん、ごきげんよろしゅう」

　と、かめはいって、また水のなかにもぐって行きました。浦島はしばらく、かめの行ゆくえを見送っていました。
　浦島は海ばたに立ったまま、しばらくそこらを見まわしました。

　春の日がぽかぽかあたって、いちめんにかすんだ海の上に、どこからともなく、にぎやかな舟うたがきこえました。
　それは夢のなかで見たふるさとの浜べの景色とちっともちがったところはありませんでした。
　けれどよく見ると、そこらの様子がなんとなくかわっていて、あう人もあう人も、いっこうに見知らない顔ばかりで、むこうでもみょうな顔をして、じろじろ見ながら、ことばもかけずにすまして行ってしまいます。`,
    methods: [
      {name:"方法A：原文そのまま",images:Array.from({length:10},(_,i)=>`img/scene4/a_${String(i+1).padStart(2,'0')}.png`)},
      {name:"方法B：抽出要素",images:Array.from({length:10},(_,i)=>`img/scene4/b_${String(i+1).padStart(2,'0')}.png`)},
      {name:"方法C：要約ベース",images:Array.from({length:10},(_,i)=>`img/scene4/c_${String(i+1).padStart(2,'0')}.png`)}
    ]
  },

  {
    id: "S5",
    title: "子どもたちにいじめられている亀を浦島太郎が見つけるシーン",
    text: `本文：
　ある日、浦島はいつもの通り海へ出て、一日お魚を釣って、帰ってきました。途中、子どもが五、六人往来に集まって、がやがや言っていました。
　何かとおもって浦島がのぞいてみると、小さいかめの子を一ぴきつかまえて、棒でつついたり、石でたたいたり、さんざんにいじめているのです。浦島は見かねて、

「まあ、そんなかわいそうなことをするものではない。いい子だから」

　と、とめましたが、子どもたちはきき入れようともしないで、

「なんだい。なんだい、かまうもんかい」

　といいながら、またかめの子を、あおむけにひっくりかえして、足でけったり、砂のなかにうずめたりしました。
　浦島はますますかわいそうにおもって、

「じゃあ、おじさんがおあしをあげるから、そのかめの子を売っておくれ」

　といいますと、こどもたちは、

「うんうん、おあしをくれるならやってもいい」

　といって、手を出しました。そこで浦島はおあしをやってかめの子をもらいうけました。
　子どもたちは、

「おじさん、ありがとう。また買っておくれよ」

　と、わいわいいいながら、行ってしまいました。`,
    methods: [
      {name:"方法A：原文そのまま",images:Array.from({length:10},(_,i)=>`img/scene5/a_${String(i+1).padStart(2,'0')}.png`)},
      {name:"方法B：抽出要素",images:Array.from({length:10},(_,i)=>`img/scene5/b_${String(i+1).padStart(2,'0')}.png`)},
      {name:"方法C：要約ベース",images:Array.from({length:10},(_,i)=>`img/scene5/c_${String(i+1).padStart(2,'0')}.png`)}
    ]
  }
];

// ======== 入力確認 ========
const btnStart=document.getElementById("btnStart");
const nameInput=document.getElementById("responderName");
function updateStartButton(){
  btnStart.disabled = !(nameInput.value.trim() );
}
nameInput.addEventListener("input",updateStartButton);

// ======== 要素取得 ========
const stepIntro=document.getElementById("stepIntro");
const stepSurvey=document.getElementById("stepSurvey");
const stepFinish=document.getElementById("stepFinish");
const targetImg=document.getElementById("targetImg");
const sceneText=document.getElementById("sceneText");
// const methodTag=document.getElementById("methodTag");
const counterTag=document.getElementById("counterTag");
const ratingBoxes=document.querySelectorAll("input[name='rating']");
const warnMsg=document.getElementById("warnMsg");

let sceneIndex=0,imageIndex=0,currentImages=[];
const sceneOrder=scenes.sort(()=>Math.random()-0.5);

// ======== シーンランダム化 ========
function randomizeScene(){
  const s=sceneOrder[sceneIndex];
  const imgs=[];
  s.methods.forEach(m=>m.images.forEach(u=>imgs.push({method:m.name,url:u})));
  currentImages=imgs.sort(()=>Math.random()-0.5);
}

// ======== 画面表示更新 ========
function render(){
  const s=sceneOrder[sceneIndex];
  const img=currentImages[imageIndex];
  document.getElementById("sceneTitle").textContent = s.title;
  sceneText.innerHTML = s.text
    .split(/\n+/) // 改行（1個以上）で段落に分割
    .map(line => `<p style="text-indent: 1em; margin: 0.6em 0;">${line.trim()}</p>`)
    .join('');
  counterTag.textContent=`${imageIndex+1}/30`;
  targetImg.src=img.url;
  ratingBoxes.forEach(b=>b.checked=false);
  warnMsg.textContent="";
}

// ======== 回答データをGASに送信 ========
async function saveResponse(name, scene, method, image, rating) {
  const payload = { name, scene, method, image, rating };
  try {
    await fetch(GAS_ENDPOINT, {
      method: "POST",
      mode: "cors",
      body: JSON.stringify(payload),
      headers: { "Content-Type": "application/json" }
    });
  } catch (err) {
    console.error("送信エラー:", err);
  }
}

// ======== 開始ボタン ========
btnStart.addEventListener("click",()=>{
  stepIntro.classList.add("hidden");
  stepSurvey.classList.remove("hidden");
  randomizeScene();
  render();
});

// ======== 次へボタン ========
document.getElementById("btnNext").addEventListener("click", async ()=>{
  const chosen=[...ratingBoxes].find(b=>b.checked);
  if(!chosen){warnMsg.textContent="選択してください";return;}

  const current = currentImages[imageIndex];
  const s = sceneOrder[sceneIndex];
  const name = nameInput.value.trim();

  // ✅ スプレッドシートへ送信
  await saveResponse(name, s.id, current.method, current.url, chosen.value);

  imageIndex++;
  if(imageIndex<30){render();return;}
  sceneIndex++;
  if(sceneIndex<1){imageIndex=0;randomizeScene();render();return;} // scene1のみ
  stepSurvey.classList.add("hidden");
  stepFinish.classList.remove("hidden");
});

// ======== 戻るボタン ========
document.getElementById("btnBack").addEventListener("click",()=>{
  if(imageIndex>0){imageIndex--;render();}
});
</script>
</body>
</html>



